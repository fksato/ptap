<!doctype html>

<head>
<meta name="mobile-web-app-capable" content="yes"> <!-- full screen https://developer.chrome.com/multidevice/android/installtohomescreen -->
<script src="https://unpkg.com/dropbox/dist/Dropbox-sdk.min.js"></script>

<script src="mkturk_DiskIO.js" type="text/javascript"></script>

<script>
(async function(){

    var DIO = new DropboxIO()
    await DIO.build(window.location.href)
    var sessionBootStrapper = await DIO.read_textfile('/MonkeyTurk_upstairs/Subjects/SessionPackages/Zico_session.json')
    sessionBootStrapper = JSON.parse(sessionBootStrapper)

    var gamePackage = await DIO.read_textfile(sessionBootStrapper['gamePackage'])
    gamePackage = JSON.parse(gamePackage)

    var IMAGEBAGS = gamePackage['IMAGEBAGS']
    var GAME = gamePackage['GAME']
    var TASK_SEQUENCE = gamePackage['TASK_SEQUENCE']
    var ENVIRONMENT = sessionBootStrapper['ENVIRONMENT']

    await localStorage.setItem("GAME", btoa(JSON.stringify(GAME)))
    await localStorage.setItem("TASK_SEQUENCE", btoa(JSON.stringify(TASK_SEQUENCE)))
    await localStorage.setItem("ENVIRONMENT", btoa(JSON.stringify(ENVIRONMENT)))
    await localStorage.setItem("IMAGEBAGS", btoa(JSON.stringify(IMAGEBAGS)))

    //await new Promise(resolve => setTimeout(resolve, 1000));
    window.location.href = "mkturk.html"

})()
</script>


</head>

<body>
Loading monkey task...
</body>
</html>